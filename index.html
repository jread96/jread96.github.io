<html>
<h1>Does Engine Cylinder Quantity Affect MPG?</h1>
<h3>Click on the checkboxes to find out!</h3>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<body onload='init()'>
<svg width=300 height=300>
</svg>
<script>
var datapoints;
async function init() {
  var proxyUrl = 'https://cors-anywhere.herokuapp.com/';
  var targetUrl = 'http://flunky.github.io/cars2017.csv';
  const data = await d3.csv(proxyUrl + targetUrl);

  var circleData = [];

  for (i = 0; i < data.length; i++) {
    circleData.push({"cx": parseInt(data[i].AverageCityMPG), "cy":
        parseInt(data[i].AverageHighwayMPG), "radius": 2 +
        parseInt(data[i].EngineCylinders)});
  }

  var margin = 50;
  var height = 200;
  var width = 200;

  var x = d3.scaleLog()
  .domain([10,150])
  .range([0,200])
  .base(10);

  var y = d3.scaleLog()
  .domain([10,150])
  .range([200,0])
  .base(10);

  var points = d3.select("svg").append("g");
  datapoints = points;

  var graph1 = d3.select("svg").append("g");
 
  var graph2 = d3.select("svg").append("g");

  points
  .selectAll('circle')
  .data(circleData)
  .enter()
  .append('circle')
  .attr("cx", function(d,i){return x(d.cx);})
  .attr("cy", function(d,i){return y(d.cy);})
  .attr("r", function(d){return d.radius;})
  .attr("transform", "translate("+margin+","+margin+")");

  graph1.attr("transform", "translate("+margin+","+margin+")")
  .call(d3.axisLeft(y).tickValues([10,20,50,100]).tickFormat(d3.format("~s")));

   graph2.attr("transform", "translate("+margin+","+(height+margin)+")")
  .call(d3.axisBottom(x).tickValues([10,20,50,100]).tickFormat(d3.format("~s")));  
}

</script>
<br>
<input type="checkbox" name="small" value="0-4" onclick="color_circles('small')">Small (0-4
cylinders)<br>
<input type="checkbox" name="medium" value="6-8" onclick="color_circles('medium')">Medium (6-8
cylinders)<br>
<input type="checkbox" name="large" value="10-12" onclick="color_circles('large')">Large (10-12
cylinders)<br>
    <script>

var clicked = [false, false, false];

function color_circles(size) {
    if (size == 'small') {
        clicked[0] = !clicked[0];
        apply_color(clicked);
  }
    else if (size == 'medium') {
        clicked[1] = !clicked[1];
        apply_color(clicked);
    }
    else if (size == 'large') {
        clicked[2] = !clicked[2];
        apply_color(clicked);
    }
}

function apply_color(clicked) {
    if (clicked[0]) {
        datapoints.selectAll('circle')
            .filter(function(d) {return d.radius <= 4})
            .style("fill", "red");
    }
    else {
         datapoints.selectAll('circle')
         .filter(function(d) {return d.radius <= 4})
         .style("fill", "lightblue");
    }

    if (clicked[1]) {
        datapoints.selectAll('circle')
            .filter(function(d) {return d.radius > 4 && d.radius <= 8})
            .style("fill", "orange");
    }
    else {
         datapoints.selectAll('circle')
         .filter(function(d) {return d.radius > 4 && d.radius <= 8})
         .style("fill", "lightblue");
    }

    if (clicked[2]) {
        datapoints.selectAll('circle')
            .filter(function(d) {return d.radius > 8})
            .style("fill", "purple");
    }
    else {
         datapoints.selectAll('circle')
         .filter(function(d) {return d.radius > 8})
         .style("fill", "lightblue");
    }
}



</script>
</body>
</html>

